# Java Architecture Rules Execution\n\n
## REGLA: backend_java_test_archunit\n- **Lenguajes soportados**: java\n- **Descripcion**: Ejecuta el test de arquitectura Java ArchUnit usando el archivo backend_java_test_archunit.java definido en el workspace si no existe obtenlo de los recursos del servidor MCP pragma usando una herramienta.\n\n
## PASOS DE EJECUCION:\n\n
### PASO 1: Buscar backend_java_test_archunit.java en el workspace\n- Buscar recursivamente el archivo backend_java_test_archunit.java en todo el proyecto\n- Si se encuentra: Ir al PASO 4\n- Si NO se encuentra: Ir al PASO 2\n\n
### PASO 2: Obtener recurso desde servidor MCP Pragma\n- Usar herramienta listPragmaResources para listar recursos disponibles\n- Buscar el recurso con nombre \"backend_java_test_archunit.java\"\n- Usar herramienta getPragmaResources para obtener el contenido del archivo\n- Ir al PASO 3\n\n
### PASO 3: Determinar ubicacion y crear archivo\n- Buscar modulos con build.gradle en el siguiente orden de prioridad:\n  1. Modulos con patron *infra*\n  2. Modulos con patron *arch*\n  3. Modulos con patron *core*\n  4. Modulos con patron *backend*\n  5. Modulos con patron *app*\n  6. Modulos con patron *delivery*\n  7. Modulos con patron *domain*\n  8. Cualquier carpeta con build.gradle\n- Si NO se encuentra ningun modulo: Abortar y notificar al usuario\n- Si se encuentra modulo: Preguntar al usuario si desea usar ese modulo o especificar otro\n- Crear la ruta: MODULE_DIR/src/test/java/architecture/backend_java_test_archunit.java\n- Usar herramienta fsWrite para crear el archivo con el contenido obtenido\n- Confirmar al usuario la ubicacion donde se creo el archivo\n\n
### PASO 4: Determinar modulo y paquete Java\n- Desde la ubicacion del archivo backend_java_test_archunit.java, subir directorios hasta encontrar build.gradle\n- Extraer el MODULE_NAME (nombre de la carpeta que contiene build.gradle)\n- Leer el archivo backend_java_test_archunit.java y buscar la linea que comienza con \"package \"\n- Extraer el PACKAGE_NAME de esa linea\n- Construir TEST_CLASS como: PACKAGE_NAME.backend_java_test_archunitbackend_java_test_archunit\n- Ejemplo: si package es \"com.pragma.architecture\" entonces TEST_CLASS sera \"com.pragma.architecture.backend_java_test_archunit\"\n\n
### PASO 5: Limpiar proyecto\n- Validar si existe gradlew o usar gradle directamente\n- Ejecutar comando usando herramienta executeBash:\n  * Si existe gradlew: \"./gradlew clean\" (en Unix) o \".\\gradlew.bat clean\" (en Windows)\n  * Si NO existe gradlew: \"gradle clean\"\n- Esperar a que termine la limpieza\n\n
### PASO 6: Ejecutar test de arquitectura\n- Construir el comando Gradle para ejecutar el test especifico:\n  * Si existe gradlew: \"./gradlew :MODULE_NAME:test --tests TEST_CLASS\" (Unix) o \".\\gradlew.bat :MODULE_NAME:test --tests TEST_CLASS\" (Windows)\n  * Si NO existe gradlew: \"gradle :MODULE_NAME:test --tests TEST_CLASS\"\n- Ejemplo: \"./gradlew :infrastructure:test --tests com.pragma.architecture.backend_java_test_archunit\"\n- Ejecutar usando herramienta executeBash\n- Capturar la salida completa del comando\n\n
### PASO 7: Analizar resultados\n- Si el test pasa exitosamente: Notificar al usuario con mensaje de exito\n- Si el test falla: Extraer los errores de ArchUnit de la salida y presentarlos de forma estructurada\n- Buscar archivos XML de reporte generados (TEST-*.xml) y mostrar resumen\n- Proporcionar recomendaciones para corregir violaciones de arquitectura detectadas\n\n
### PASO 8: Generar y presentar reportes en multiples formatos\n- Los reportes se generan automaticamente por Gradle en varios formatos:\n  * **Reporte HTML**: Buscar en MODULE_DIR/build/reports/tests/test/index.html\n  * **Reporte XML**: Buscar en MODULE_DIR/build/test-results/test/TEST-*.xml\n  * **Reportes detallados por clase**: MODULE_DIR/build/reports/tests/test/classes/*.html\n- Informar al usuario la ubicacion completa de los reportes generados:\n  * Ruta absoluta al reporte HTML principal (index.html)\n  * Lista de todos los archivos XML generados\n  * Reportes detallados disponibles por clase de test\n- Opciones para el usuario:\n  1. **Abrir reporte HTML en navegador**:\n     - En Windows: ejecutar comando \"start MODULE_DIR\\build\\reports\\tests\\test\\index.html\"\n     - En Linux: ejecutar comando \"xdg-open MODULE_DIR/build/reports/tests/test/index.html\"\n     - En Mac: ejecutar comando \"open MODULE_DIR/build/reports/tests/test/index.html\"\n  2. **Ver resumen en consola**: Mostrar resumen de tests ejecutados, exitosos y fallidos\n  3. **Copiar reportes a otra ubicacion**: Solicitar ruta destino y copiar usando herramienta fsWrite\n  4. **Generar reporte consolidado personalizado**: Crear archivo Markdown con resumen ejecutivo\n- Estructura de reportes disponibles:\n  * index.html: Vista principal con resumen de todos los tests\n  * classes/architecture.backend_java_test_archunit.html: Detalle especifico del test de arquitectura\n  * css/: Archivos de estilo del reporte HTML\n  * js/: Scripts JavaScript para interactividad del reporte\n  * TEST-architecture.backend_java_test_archunit.xml: Formato XML para integracion CI/CD\n- Si el proyecto tiene configurado JaCoCo para cobertura de codigo, informar tambien:\n  * Reporte de cobertura HTML: MODULE_DIR/build/reports/jacoco/test/html/index.html\n  * Reporte de cobertura XML: MODULE_DIR/build/reports/jacoco/test/jacocoTestReport.xml\n- Preguntar al usuario que accion desea realizar con los reportes generados\n\n
## FORMATO DE SALIDA REQUERIDO:\n```json\n[{\n  \"resultado\": \"success|failure\",\n  \"modulo\": \"string\",\n  \"test_class\": \"string\",\n  \"mensaje\": \"string\",\n  \"tests_ejecutados\": number,\n  \"tests_fallidos\": number,\n  \"violaciones\": [{\n    \"regla\": \"string\",\n    \"descripcion\": \"string\",\n    \"clases_afectadas\": [\"string\"]\n  }],\n  \"recomendaciones\": [\"string\"],\n  \"reportes\": {\n    \"html_principal\": \"string\",\n    \"html_detallado\": [\"string\"],\n    \"xml\": [\"string\"],\n    \"cobertura_html\": \"string\",\n    \"cobertura_xml\": \"string\"\n  }\n}]\n```\n\n
## MANEJO DE ERRORES:\n- Si no se encuentra build.gradle: Informar que el proyecto no usa Gradle\n- Si no se puede determinar el paquete: Solicitar al usuario que verifique el archivo\n- Si el comando Gradle falla: Mostrar el error completo y sugerir verificar dependencias\n- Si ArchUnit no esta configurado: Sugerir agregar dependencia en build.gradle\n- Si no se generan reportes HTML: Verificar que la tarea test de Gradle esta configurada correctamente\n\n
## NOTAS IMPORTANTES:\n- En Windows usar .\\gradlew.bat en lugar de ./gradlew\n- Asegurar que gradlew tenga permisos de ejecucion en Unix/Linux\n- Los reportes HTML se generan automaticamente en build/reports/tests/test/\n- Los reportes XML se generan en build/test-results/test/\n- ArchUnit requiere la dependencia com.tngtech.archunit:archunit-junit5 en build.gradle\n- Para generar reportes de cobertura, agregar plugin JaCoCo en build.gradle\n- Los reportes HTML son interactivos y navegables via navegador web